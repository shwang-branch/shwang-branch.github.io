<!DOCTYPE html>
<html>

    <head>
        <script type="text/javascript">
            var isiOSWebView = /(iPhone|iPod|iPad).*AppleWebKit(?!.*Version)/i.test(navigator.userAgent);
            var isAndroidWebView = /Blood Donor\/[0-9\.]+$/.test(navigator.userAgent);
            var isWebView = isiOSWebView || isAndroidWebView;
            
            (function(b, r, a, n, c, h, _, s, d, k) { if (!b[n] || !b[n]._q) { for (; s < _.length;) c(h, _[s++]);
                                                                              d = r.createElement(a);
                                                                              d.async = 1;
                                                                              d.src = "https://cdn.branch.io/branch-latest.min.js";
                                                                              k = r.getElementsByTagName(a)[0];
                                                                              k.parentNode.insertBefore(d, k);
                                                                              b[n] = h } })(window, document, "script", "branch", function(b, r) { b[r] = function() { b._q.push([r, arguments]) } }, { _q: [], _v: 1 }, "addListener applyCode autoAppIndex banner closeBanner closeJourney creditHistory credits data deepview deepviewCta first getCode init link logout redeem referrals removeListener sendSMS setBranchViewData setIdentity track validateCode trackCommerceEvent logEvent disableTracking".split(" "), 0);
            // init Branch
            //         branch.init('key_live_ciHy2mMMoX6CpES3EiLzqhfetvpzmV5D');

            //    branch.init('key_live_ciHy2mMMoX6CpES3EiLzqhfetvpzmV5D', {
            //        metadata: {
            //            'hasSiteID': 'false'
            //        }
            //    });
            branch.init('key_live_ccQ8piFdCMPVysh8TLmEhghmuCk162Rr', { 'no_journeys': isWebView }, function(error, data) {
                console.log(data);
                console.log(isWebView);
            });
        </script>


    </head>

    <body>
        <h1>Hello World</h1>
        <p>I'm hosted with GitHub Pages.</p>

        <button onclick="myFunction()">Log event</button>
        <script>
            function myFunction() {
                var isiOSWebView = /(iPhone|iPod|iPad).*AppleWebKit(?!.*Version)/i.test("Mozilla/5.0 (iPhone; CPU iPhone OS 13_2_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Mobile/15E148 Safari/604.1");
                console.log(isiOSWebView);
                
                var isAndroidWebView = /BLOOD\/[0-9\.]+$/.test("BLOOD/2.2.0 Dalvik/2.1.0 (Linux; U; Android 11; Pixel 3a XL Build/RQ1A.210105.002)");
                console.log(isAndroidWebView);
                
                branch.closeJourney(function(err, data) {
                    if (err) {
                        console.log(err, data); 
                        if (err == 'Journey already dismissed.') {
                            setTimeout(function(){
                                //branch.setBranchViewData({'setBranchViewData-key1':'value1','setBranchViewData-key2':'value2'});

                                // optional additional deep link data
                                var linkData = {
                                    data: {
                                        'custom_bool': true,
                                        '$journeys_cta': 'https://psmaster.app.link/?~campaign=custom-campaign&~campaign_id=123456&~channel=not-journeys',
                                        'custom_int': Date.now(),
                                        'custom_campaign': 'customer_campaign',
                                        '~customer_campaign': 'customer_campaign',
                                        '~channel' : "channel",
                                        'gclid' : "gclid-value"
                                    }
                                };
                                branch.setBranchViewData(linkData);
                                console.log('logging pageview from error'); 

                                branch.track('pageview', {'key1':'value1','pageview-key2':'value2'});
                            }, 1000);
                        }
                    }
                    else {
                        setTimeout(function(){
                            //branch.setBranchViewData({'setBranchViewData-key1':'value1','setBranchViewData-key2':'value2'});

                            // optional additional deep link data
                            var linkData = {
                                data: {
                                    'custom_bool': true,
                                    '$journeys_cta': 'https://psmaster.app.link/?~campaign=custom-campaign&~campaign_id=123456&~channel=not-journeys',
                                    'custom_int': Date.now(),
                                    'custom_campaign': 'customer_campaign',
                                    '~customer_campaign': 'customer_campaign',
                                    '~channel' : "channel",
                                    'gclid' : "gclid-value"
                                }
                            };
                            branch.setBranchViewData(linkData);
                            console.log('logging pageview from error'); 

                            branch.track('pageview', {'key1':'value1','pageview-key2':'value2'});
                        }, 1000);
                    }
                });

            }
        </script>
    </body>

</html>